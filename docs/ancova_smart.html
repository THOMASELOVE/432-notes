<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Science for Biological, Medical and Health Research - 12&nbsp; Analysis of Covariance with the SMART data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./nonlinearity.html" rel="next">
<link href="./ancova_emphysema.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ancova_smart.html"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Analysis of Covariance with the SMART data</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science for Biological, Medical and Health Research</a> 
        <div class="sidebar-tools-main">
    <a href="./Data-Science-for-Biological,-Medical-and-Health-Research.pdf" rel="" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./incomplete.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">This is work in progress</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R Setup</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nhanes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Building the <code>nh432</code> example</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nh432cb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Codebook for <code>nh432</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./431review1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">431 Review: Comparing Means</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./431review2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">431 Review: Comparing Rates</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./431review3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">431 Review: Fitting Linear Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./smart.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">BRFSS SMART Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./singleimputation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Dealing with Missingness: Single Imputation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datasummaries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Summarizing <code>smart_cle1</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./anovasmart.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Analysis of Variance with SMART</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./anovaexamples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Two-Way ANOVA and Interaction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ancova_emphysema.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Analysis of Covariance</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ancova_smart.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Analysis of Covariance with the SMART data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nonlinearity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Adding Non-linear Terms to a Linear Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./olsfitting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Using <code>ols</code> to fit linear models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prostate1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">A Model for Prostate Cancer</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prostate2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Validating our Prostate Cancer Model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multiple_imp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Multiple Imputation and Linear Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tableone.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Building Table 1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logistic1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Logistic Regression: The Foundations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logistic2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Logistic Regression with <code>glm</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logistic3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Logistic Regression with <code>lrm</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./effectsize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Estimating and Interpreting Effect Sizes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./binaryregression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Colorectal Cancer Screening and Some Special Cases</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./count1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Modeling a Count Outcome</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./count2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Negative Binomial Models for Count Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./count3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Zero-Inflated Models for Count Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ordinaloutcome.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Modeling an Ordinal Categorical Outcome</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multinomial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Multinomial Logistic Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./survival_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Time To Event / Survival Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cox1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Cox Regression Models, Part 1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cox2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Cox Regression Models, Part 2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lasso.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">NEW!! A Few LASSO Ideas</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">NEW!! Bayes and a Linear Model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#r-setup-used-here" id="toc-r-setup-used-here" class="nav-link active" data-scroll-target="#r-setup-used-here"><span class="header-section-number">12.1</span> R Setup Used Here</a>
  <ul class="collapse">
  <li><a href="#data-load" id="toc-data-load" class="nav-link" data-scroll-target="#data-load"><span class="header-section-number">12.1.1</span> Data Load</a></li>
  </ul></li>
  <li><a href="#a-new-small-study-predicting-bmi" id="toc-a-new-small-study-predicting-bmi" class="nav-link" data-scroll-target="#a-new-small-study-predicting-bmi"><span class="header-section-number">12.2</span> A New Small Study: Predicting BMI</a>
  <ul class="collapse">
  <li><a href="#does-smoke100-predict-bmi-well" id="toc-does-smoke100-predict-bmi-well" class="nav-link" data-scroll-target="#does-smoke100-predict-bmi-well"><span class="header-section-number">12.2.1</span> Does <code>smoke100</code> predict <code>bmi</code> well?</a></li>
  </ul></li>
  <li><a href="#mod1-a-simple-t-test-model" id="toc-mod1-a-simple-t-test-model" class="nav-link" data-scroll-target="#mod1-a-simple-t-test-model"><span class="header-section-number">12.3</span> <code>mod1</code>: A simple t-test model</a></li>
  <li><a href="#mod2-adding-another-predictor-two-way-anova-without-interaction" id="toc-mod2-adding-another-predictor-two-way-anova-without-interaction" class="nav-link" data-scroll-target="#mod2-adding-another-predictor-two-way-anova-without-interaction"><span class="header-section-number">12.4</span> <code>mod2</code>: Adding another predictor (two-way ANOVA without interaction)</a></li>
  <li><a href="#mod3-adding-the-interaction-term-two-way-anova-with-interaction" id="toc-mod3-adding-the-interaction-term-two-way-anova-with-interaction" class="nav-link" data-scroll-target="#mod3-adding-the-interaction-term-two-way-anova-with-interaction"><span class="header-section-number">12.5</span> <code>mod3</code>: Adding the interaction term (Two-way ANOVA with interaction)</a></li>
  <li><a href="#mod4-using-smoke100-and-physhealth-in-a-model-for-bmi" id="toc-mod4-using-smoke100-and-physhealth-in-a-model-for-bmi" class="nav-link" data-scroll-target="#mod4-using-smoke100-and-physhealth-in-a-model-for-bmi"><span class="header-section-number">12.6</span> <code>mod4</code>: Using <code>smoke100</code> and <code>physhealth</code> in a model for <code>bmi</code></a></li>
  <li><a href="#making-predictions-with-a-linear-regression-model" id="toc-making-predictions-with-a-linear-regression-model" class="nav-link" data-scroll-target="#making-predictions-with-a-linear-regression-model"><span class="header-section-number">12.7</span> Making Predictions with a Linear Regression Model</a>
  <ul class="collapse">
  <li><a href="#fitting-an-individual-prediction-and-95-prediction-interval" id="toc-fitting-an-individual-prediction-and-95-prediction-interval" class="nav-link" data-scroll-target="#fitting-an-individual-prediction-and-95-prediction-interval"><span class="header-section-number">12.7.1</span> Fitting an Individual Prediction and 95% Prediction Interval</a></li>
  <li><a href="#confidence-interval-for-an-average-prediction" id="toc-confidence-interval-for-an-average-prediction" class="nav-link" data-scroll-target="#confidence-interval-for-an-average-prediction"><span class="header-section-number">12.7.2</span> Confidence Interval for an Average Prediction</a></li>
  <li><a href="#fitting-multiple-individual-predictions-to-new-data" id="toc-fitting-multiple-individual-predictions-to-new-data" class="nav-link" data-scroll-target="#fitting-multiple-individual-predictions-to-new-data"><span class="header-section-number">12.7.3</span> Fitting Multiple Individual Predictions to New Data</a></li>
  </ul></li>
  <li><a href="#centering-the-model" id="toc-centering-the-model" class="nav-link" data-scroll-target="#centering-the-model"><span class="header-section-number">12.8</span> Centering the model</a>
  <ul class="collapse">
  <li><a href="#plot-of-model-4-on-centered-physhealth-mod4_c" id="toc-plot-of-model-4-on-centered-physhealth-mod4_c" class="nav-link" data-scroll-target="#plot-of-model-4-on-centered-physhealth-mod4_c"><span class="header-section-number">12.8.1</span> Plot of Model 4 on Centered <code>physhealth</code>: <code>mod4_c</code></a></li>
  </ul></li>
  <li><a href="#rescaling-an-input-by-subtracting-the-mean-and-dividing-by-2-standard-deviations" id="toc-rescaling-an-input-by-subtracting-the-mean-and-dividing-by-2-standard-deviations" class="nav-link" data-scroll-target="#rescaling-an-input-by-subtracting-the-mean-and-dividing-by-2-standard-deviations"><span class="header-section-number">12.9</span> Rescaling an input by subtracting the mean and dividing by 2 standard deviations</a>
  <ul class="collapse">
  <li><a href="#refitting-model-mod4-to-the-rescaled-data" id="toc-refitting-model-mod4-to-the-rescaled-data" class="nav-link" data-scroll-target="#refitting-model-mod4-to-the-rescaled-data"><span class="header-section-number">12.9.1</span> Refitting model <code>mod4</code> to the rescaled data</a></li>
  <li><a href="#interpreting-the-model-on-rescaled-data" id="toc-interpreting-the-model-on-rescaled-data" class="nav-link" data-scroll-target="#interpreting-the-model-on-rescaled-data"><span class="header-section-number">12.9.2</span> Interpreting the model on rescaled data</a></li>
  <li><a href="#plot-of-model-on-rescaled-data" id="toc-plot-of-model-on-rescaled-data" class="nav-link" data-scroll-target="#plot-of-model-on-rescaled-data"><span class="header-section-number">12.9.3</span> Plot of model on rescaled data</a></li>
  </ul></li>
  <li><a href="#mod5-what-if-we-add-more-variables" id="toc-mod5-what-if-we-add-more-variables" class="nav-link" data-scroll-target="#mod5-what-if-we-add-more-variables"><span class="header-section-number">12.10</span> <code>mod5</code>: What if we add more variables?</a></li>
  <li><a href="#mod6-would-adding-self-reported-health-help" id="toc-mod6-would-adding-self-reported-health-help" class="nav-link" data-scroll-target="#mod6-would-adding-self-reported-health-help"><span class="header-section-number">12.11</span> <code>mod6</code>: Would adding self-reported health help?</a></li>
  <li><a href="#key-regression-assumptions-for-building-effective-prediction-models" id="toc-key-regression-assumptions-for-building-effective-prediction-models" class="nav-link" data-scroll-target="#key-regression-assumptions-for-building-effective-prediction-models"><span class="header-section-number">12.12</span> Key Regression Assumptions for Building Effective Prediction Models</a>
  <ul class="collapse">
  <li><a href="#checking-assumptions-in-model-mod6" id="toc-checking-assumptions-in-model-mod6" class="nav-link" data-scroll-target="#checking-assumptions-in-model-mod6"><span class="header-section-number">12.12.1</span> Checking Assumptions in model <code>mod6</code></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Analysis of Covariance with the SMART data</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>In this chapter, we’ll work with the <code>smart_cle1_sh</code> data file that we developed in <a href="singleimputation.html"><span>Chapter&nbsp;7</span></a>.</p>
<section id="r-setup-used-here" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="r-setup-used-here"><span class="header-section-number">12.1</span> R Setup Used Here</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">comment =</span> <span class="cn">NA</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaic)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="data-load" class="level3" data-number="12.1.1">
<h3 data-number="12.1.1" class="anchored" data-anchor-id="data-load"><span class="header-section-number">12.1.1</span> Data Load</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>smart_cle1_sh <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/smart_cle1_sh.Rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="a-new-small-study-predicting-bmi" class="level2" data-number="12.2">
<h2 data-number="12.2" class="anchored" data-anchor-id="a-new-small-study-predicting-bmi"><span class="header-section-number">12.2</span> A New Small Study: Predicting BMI</h2>
<p>We’ll begin by investigating the problem of predicting <code>bmi</code>, at first with just three regression inputs: <code>smoke100</code>, <code>female</code> and <code>physhealth</code>, in our <code>smart_cle1_sh</code> data set.</p>
<ul>
<li>The outcome of interest is <code>bmi</code>.</li>
<li>Inputs to the regression model are:
<ul>
<li><code>smoke100</code> = 1 if the subject has smoked 100 cigarettes in their lifetime</li>
<li><code>female</code> = 1 if the subject is female, and 0 if they are male</li>
<li><code>physhealth</code> = number of poor physical health days in past 30 (treated as quantitative)</li>
</ul></li>
</ul>
<section id="does-smoke100-predict-bmi-well" class="level3" data-number="12.2.1">
<h3 data-number="12.2.1" class="anchored" data-anchor-id="does-smoke100-predict-bmi-well"><span class="header-section-number">12.2.1</span> Does <code>smoke100</code> predict <code>bmi</code> well?</h3>
<section id="graphical-assessment" class="level4" data-number="12.2.1.1">
<h4 data-number="12.2.1.1" class="anchored" data-anchor-id="graphical-assessment"><span class="header-section-number">12.2.1.1</span> Graphical Assessment</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(smart_cle1_sh, <span class="fu">aes</span>(<span class="at">x =</span> smoke100, <span class="at">y =</span> bmi)) <span class="sc">+</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ancova_smart_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Not so helpful. We should probably specify that <code>smoke100</code> is a factor, and try another plotting approach.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(smart_cle1_sh, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(smoke100), <span class="at">y =</span> bmi)) <span class="sc">+</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ancova_smart_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The median BMI looks a little higher for those who have smoked 100 cigarettes. Let’s see if a model reflects that.</p>
</section>
</section>
</section>
<section id="mod1-a-simple-t-test-model" class="level2" data-number="12.3">
<h2 data-number="12.3" class="anchored" data-anchor-id="mod1-a-simple-t-test-model"><span class="header-section-number">12.3</span> <code>mod1</code>: A simple t-test model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(bmi <span class="sc">~</span> smoke100, <span class="at">data =</span> smart_cle1_sh)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>mod1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = bmi ~ smoke100, data = smart_cle1_sh)

Coefficients:
(Intercept)     smoke100  
    27.9390       0.8722  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = bmi ~ smoke100, data = smart_cle1_sh)

Residuals:
    Min      1Q  Median      3Q     Max 
-15.511  -4.019  -0.870   2.841  41.749 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  27.9390     0.2594 107.722   &lt;2e-16 ***
smoke100      0.8722     0.3781   2.307   0.0213 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 6.353 on 1131 degrees of freedom
Multiple R-squared:  0.004682,  Adjusted R-squared:  0.003802 
F-statistic: 5.321 on 1 and 1131 DF,  p-value: 0.02125</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(mod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 2.5 %    97.5 %
(Intercept) 27.4301016 28.447875
smoke100     0.1303021  1.614195</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(mod1, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  term        estimate std.error statistic p.value conf.low conf.high
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
1 (Intercept)   27.9       0.259    108.    0        27.4       28.4 
2 smoke100       0.872     0.378      2.31  0.0213    0.130      1.61</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(mod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 12
  r.squared adj.r.squared sigma statistic p.value    df logLik   AIC   BIC
      &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1   0.00468       0.00380  6.35      5.32  0.0213     1 -3702. 7409. 7424.
# ℹ 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;</code></pre>
</div>
</div>
<p>The model suggests, based on these 1133 subjects, that</p>
<ul>
<li>our best prediction for non-smokers is BMI = 27.94 kg/m<sup>2</sup>, and</li>
<li>our best prediction for those who have smoked 100 cigarettes is BMI = 27.94 + 0.87 = 28.81 kg/m<sup>2</sup>.</li>
<li>the mean difference between smokers and non-smokers is +0.87 kg/m<sup>2</sup> in BMI</li>
<li>a 95% confidence (uncertainty) interval for that mean smoker - non-smoker difference in BMI ranges from 0.13 to 1.61</li>
<li>the model accounts for 0.47% of the variation in BMI, so that knowing the respondent’s tobacco status does very little to reduce the size of the prediction errors as compared to an intercept only model that would predict the overall mean BMI for each of our subjects.</li>
<li>the model makes some enormous errors, with one subject being predicted to have a BMI 42 points lower than his/her actual BMI.</li>
</ul>
<p>Note that this simple regression model just gives us the t-test.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(bmi <span class="sc">~</span> smoke100, <span class="at">var.equal =</span> <span class="cn">TRUE</span>, <span class="at">data =</span> smart_cle1_sh)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Two Sample t-test

data:  bmi by smoke100
t = -2.3066, df = 1131, p-value = 0.02125
alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0
95 percent confidence interval:
 -1.6141946 -0.1303021
sample estimates:
mean in group 0 mean in group 1 
       27.93899        28.81124 </code></pre>
</div>
</div>
</section>
<section id="mod2-adding-another-predictor-two-way-anova-without-interaction" class="level2" data-number="12.4">
<h2 data-number="12.4" class="anchored" data-anchor-id="mod2-adding-another-predictor-two-way-anova-without-interaction"><span class="header-section-number">12.4</span> <code>mod2</code>: Adding another predictor (two-way ANOVA without interaction)</h2>
<p>When we add in the information about <code>female</code> (sex) to our original model, we might first picture the data. We could look at separate histograms,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(smart_cle1_sh, <span class="fu">aes</span>(<span class="at">x =</span> bmi)) <span class="sc">+</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(female <span class="sc">~</span> smoke100, <span class="at">labeller =</span> label_both)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ancova_smart_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>or maybe boxplots?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(smart_cle1_sh, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(female), <span class="at">y =</span> bmi)) <span class="sc">+</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> smoke100, <span class="at">labeller =</span> label_both)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ancova_smart_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(smart_cle1_sh, <span class="fu">aes</span>(<span class="at">x =</span> female, <span class="at">y =</span> bmi))<span class="sc">+</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> smoke100, <span class="at">labeller =</span> label_both)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ancova_smart_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>OK. Let’s try fitting a model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(bmi <span class="sc">~</span> female <span class="sc">+</span> smoke100, <span class="at">data =</span> smart_cle1_sh)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>mod2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = bmi ~ female + smoke100, data = smart_cle1_sh)

Coefficients:
(Intercept)       female     smoke100  
    28.0265      -0.1342       0.8555  </code></pre>
</div>
</div>
<p>This new model predicts only four predicted values:</p>
<ul>
<li><code>bmi</code> = 28.0265 if the subject is male and has not smoked 100 cigarettes (so <code>female</code> = 0 and <code>smoke100</code> = 0)</li>
<li><code>bmi</code> = 28.0265 - 0.1342 = 27.8923 if the subject is female and has not smoked 100 cigarettes (<code>female</code> = 1 and <code>smoke100</code> = 0)</li>
<li><code>bmi</code> = 28.0265 + 0.8555 = 28.8820 if the subject is male and has smoked 100 cigarettes (so <code>female</code> = 0 and <code>smoke100</code> = 1), and, finally</li>
<li><code>bmi</code> = 28.0265 - 0.1342 + 0.8555 = 28.7478 if the subject is female and has smoked 100 cigarettes (so both <code>female</code> and <code>smoke100</code> = 1).</li>
</ul>
<p>Another way to put this is that for those who have not smoked 100 cigarettes, the model is:</p>
<ul>
<li><code>bmi</code> = 28.0265 - 0.1342 <code>female</code></li>
</ul>
<p>and for those who have smoked 100 cigarettes, the model is:</p>
<ul>
<li><code>bmi</code> = 28.8820 - 0.1342 <code>female</code></li>
</ul>
<p>Only the intercept of the <code>bmi-female</code> model changes depending on <code>smoke100</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = bmi ~ female + smoke100, data = smart_cle1_sh)

Residuals:
    Min      1Q  Median      3Q     Max 
-15.448  -3.972  -0.823   2.774  41.678 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  28.0265     0.3620  77.411   &lt;2e-16 ***
female       -0.1342     0.3875  -0.346   0.7291    
smoke100      0.8555     0.3814   2.243   0.0251 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 6.356 on 1130 degrees of freedom
Multiple R-squared:  0.004788,  Adjusted R-squared:  0.003027 
F-statistic: 2.718 on 2 and 1130 DF,  p-value: 0.06642</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(mod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 2.5 %     97.5 %
(Intercept) 27.3161140 28.7368281
female      -0.8944773  0.6259881
smoke100     0.1072974  1.6037825</code></pre>
</div>
</div>
<p>The slopes of both <code>female</code> and <code>smoke100</code> have confidence intervals that are completely below zero, indicating that both <code>female</code> sex and <code>smoke100</code> appear to be associated with reductions in <code>bmi</code>.</p>
<p>The <span class="math inline">\(R^2\)</span> value suggests that 0.4788% of the variation in <code>bmi</code> is accounted for by this ANOVA model.</p>
<p>In fact, this regression (on two binary indicator variables) is simply a two-way ANOVA model without an interaction term.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: bmi
            Df Sum Sq Mean Sq F value  Pr(&gt;F)  
female       1     16  16.301  0.4036 0.52538  
smoke100     1    203 203.296  5.0330 0.02506 *
Residuals 1130  45644  40.393                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="mod3-adding-the-interaction-term-two-way-anova-with-interaction" class="level2" data-number="12.5">
<h2 data-number="12.5" class="anchored" data-anchor-id="mod3-adding-the-interaction-term-two-way-anova-with-interaction"><span class="header-section-number">12.5</span> <code>mod3</code>: Adding the interaction term (Two-way ANOVA with interaction)</h2>
<p>Suppose we want to let the effect of <code>female</code> vary depending on the <code>smoke100</code> status. Then we need to incorporate an interaction term in our model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(bmi <span class="sc">~</span> female <span class="sc">*</span> smoke100, <span class="at">data =</span> smart_cle1_sh)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>mod3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = bmi ~ female * smoke100, data = smart_cle1_sh)

Coefficients:
    (Intercept)           female         smoke100  female:smoke100  
        28.2690          -0.5064           0.4119           0.7536  </code></pre>
</div>
</div>
<p>So, for example, for a male who has smoked 100 cigarettes, this model predicts</p>
<ul>
<li><code>bmi</code> = 28.269 - 0.506 (0) + 0.412 (1) + 0.754 (0)(1) = 28.269 + 0.412 = 28.681</li>
</ul>
<p>And for a female who has smoked 100 cigarettes, the model predicts</p>
<ul>
<li><code>bmi</code> = 28.269 - 0.506 (1) + 0.412 (1) + 0.754 (1)(1) = 28.269 - 0.506 + 0.412 + 0.754 = 28.929</li>
</ul>
<p>For those who have not smoked 100 cigarettes, the model is:</p>
<ul>
<li><code>bmi</code> = 28.269 - 0.506 <code>female</code></li>
</ul>
<p>But for those who have smoked 100 cigarettes, the model is:</p>
<ul>
<li><code>bmi</code> = (28.269 + 0.412) + (-0.506 + 0.754) <code>female</code>, or ,,,</li>
<li><code>bmi</code> = 28.681 - 0.248 <code>female</code></li>
</ul>
<p>Now, both the slope and the intercept of the <code>bmi-female</code> model change depending on <code>smoke100</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = bmi ~ female * smoke100, data = smart_cle1_sh)

Residuals:
    Min      1Q  Median      3Q     Max 
-15.628  -3.938  -0.829   2.759  41.879 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)      28.2690     0.4396  64.301   &lt;2e-16 ***
female           -0.5064     0.5446  -0.930    0.353    
smoke100          0.4119     0.5946   0.693    0.489    
female:smoke100   0.7536     0.7750   0.972    0.331    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 6.356 on 1129 degrees of freedom
Multiple R-squared:  0.005621,  Adjusted R-squared:  0.002979 
F-statistic: 2.127 on 3 and 1129 DF,  p-value: 0.09507</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(mod3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     2.5 %     97.5 %
(Intercept)     27.4063783 29.1315563
female          -1.5749026  0.5621793
smoke100        -0.7547605  1.5786121
female:smoke100 -0.7670239  2.2742178</code></pre>
</div>
</div>
<p>In fact, this regression (on two binary indicator variables and a product term) is simply a two-way ANOVA model with an interaction term.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: bmi
                  Df Sum Sq Mean Sq F value  Pr(&gt;F)  
female             1     16  16.301  0.4035 0.52539  
smoke100           1    203 203.296  5.0327 0.02507 *
female:smoke100    1     38  38.194  0.9455 0.33107  
Residuals       1129  45606  40.395                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The interaction term doesn’t change very much here. Its uncertainty interval includes zero, and the overall model still accounts for less than 1% of the variation in <code>bmi</code>.</p>
</section>
<section id="mod4-using-smoke100-and-physhealth-in-a-model-for-bmi" class="level2" data-number="12.6">
<h2 data-number="12.6" class="anchored" data-anchor-id="mod4-using-smoke100-and-physhealth-in-a-model-for-bmi"><span class="header-section-number">12.6</span> <code>mod4</code>: Using <code>smoke100</code> and <code>physhealth</code> in a model for <code>bmi</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(smart_cle1_sh, <span class="fu">aes</span>(<span class="at">x =</span> physhealth, <span class="at">y =</span> bmi, <span class="at">color =</span> <span class="fu">factor</span>(smoke100))) <span class="sc">+</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">col =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> smoke100, <span class="at">labeller =</span> label_both) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ancova_smart_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Does the difference in slopes of <code>bmi</code> and <code>physhealth</code> for those who have and haven’t smoked at least 100 cigarettes appear to be substantial and important?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>mod4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(bmi <span class="sc">~</span> smoke100 <span class="sc">*</span> physhealth, <span class="at">data =</span> smart_cle1_sh)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = bmi ~ smoke100 * physhealth, data = smart_cle1_sh)

Residuals:
    Min      1Q  Median      3Q     Max 
-19.011  -3.811  -0.559   2.609  38.249 

Coefficients:
                    Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)         27.49077    0.28369  96.904  &lt; 2e-16 ***
smoke100             0.57017    0.41911   1.360 0.173965    
physhealth           0.10840    0.02995   3.619 0.000308 ***
smoke100:physhealth  0.03326    0.04093   0.813 0.416561    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 6.252 on 1129 degrees of freedom
Multiple R-squared:  0.03782,   Adjusted R-squared:  0.03526 
F-statistic: 14.79 on 3 and 1129 DF,  p-value: 1.886e-09</code></pre>
</div>
</div>
<p>Does it seem as though the addition of <code>physhealth</code> has improved our model substantially over a model with <code>smoke100</code> alone (which, you recall, was <code>mod1</code>)?</p>
<p>Since the <code>mod4</code> model contains the <code>mod1</code> model’s predictors as a subset and the outcome is the same for each model, we consider the models <em>nested</em> and have some extra tools available to compare them.</p>
<ul>
<li>I might start by looking at the basic summaries for each model.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(mod4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 12
  r.squared adj.r.squared sigma statistic       p.value    df logLik   AIC   BIC
      &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1    0.0378        0.0353  6.25      14.8 0.00000000189     3 -3682. 7375. 7400.
# ℹ 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(mod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 12
  r.squared adj.r.squared sigma statistic p.value    df logLik   AIC   BIC
      &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1   0.00468       0.00380  6.35      5.32  0.0213     1 -3702. 7409. 7424.
# ℹ 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;</code></pre>
</div>
</div>
<ul>
<li>The <span class="math inline">\(R^2\)</span> is much larger for the model with <code>physhealth</code>, but still very tiny.</li>
<li>Smaller AIC and smaller BIC statistics are more desirable. Here, there’s little to choose from, so <code>mod4</code> looks better, too.</li>
<li>We might also consider a significance test by looking at an ANOVA model comparison. This is only appropriate because <code>mod1</code> is nested in <code>mod4</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod4, mod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: bmi ~ smoke100 * physhealth
Model 2: bmi ~ smoke100
  Res.Df   RSS Df Sum of Sq     F    Pr(&gt;F)    
1   1129 44129                                 
2   1131 45649 -2   -1519.7 19.44 5.005e-09 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The addition of the <code>physhealth</code> term appears to be an improvement, not that that means very much.</p>
</section>
<section id="making-predictions-with-a-linear-regression-model" class="level2" data-number="12.7">
<h2 data-number="12.7" class="anchored" data-anchor-id="making-predictions-with-a-linear-regression-model"><span class="header-section-number">12.7</span> Making Predictions with a Linear Regression Model</h2>
<p>Recall model 4, which yields predictions for body mass index on the basis of the main effects of having smoked (<code>smoke100</code>) and days of poor physical health (<code>physhealth</code>) and their interaction.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>mod4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = bmi ~ smoke100 * physhealth, data = smart_cle1_sh)

Coefficients:
        (Intercept)             smoke100           physhealth  
           27.49077              0.57017              0.10840  
smoke100:physhealth  
            0.03326  </code></pre>
</div>
</div>
<section id="fitting-an-individual-prediction-and-95-prediction-interval" class="level3" data-number="12.7.1">
<h3 data-number="12.7.1" class="anchored" data-anchor-id="fitting-an-individual-prediction-and-95-prediction-interval"><span class="header-section-number">12.7.1</span> Fitting an Individual Prediction and 95% Prediction Interval</h3>
<p>What do we predict for the <code>bmi</code> of a subject who has smoked at least 100 cigarettes in their life and had 8 poor physical health days in the past 30?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>new1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">smoke100 =</span> <span class="dv">1</span>, <span class="at">physhealth =</span> <span class="dv">8</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(mod4, <span class="at">newdata =</span> new1, <span class="at">interval =</span> <span class="st">"prediction"</span>, <span class="at">level =</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit      lwr      upr
1 29.19423 16.91508 41.47338</code></pre>
</div>
</div>
<p>The predicted <code>bmi</code> for this new subject is shown above. The prediction interval shows the bounds of a 95% uncertainty interval for a predicted <code>bmi</code> for an individual smoker<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> who has 8 days of poor physical health out of the past 30. From the <code>predict</code> function applied to a linear model, we can get the prediction intervals for any new data points in this manner.</p>
</section>
<section id="confidence-interval-for-an-average-prediction" class="level3" data-number="12.7.2">
<h3 data-number="12.7.2" class="anchored" data-anchor-id="confidence-interval-for-an-average-prediction"><span class="header-section-number">12.7.2</span> Confidence Interval for an Average Prediction</h3>
<ul>
<li>What do we predict for the <strong>average body mass index of a population of subjects</strong> who are smokers and have <code>physhealth = 8</code>?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(mod4, <span class="at">newdata =</span> new1, <span class="at">interval =</span> <span class="st">"confidence"</span>, <span class="at">level =</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit      lwr      upr
1 29.19423 28.64267 29.74579</code></pre>
</div>
</div>
<ul>
<li>How does this result compare to the prediction interval?</li>
</ul>
</section>
<section id="fitting-multiple-individual-predictions-to-new-data" class="level3" data-number="12.7.3">
<h3 data-number="12.7.3" class="anchored" data-anchor-id="fitting-multiple-individual-predictions-to-new-data"><span class="header-section-number">12.7.3</span> Fitting Multiple Individual Predictions to New Data</h3>
<ul>
<li>How does our prediction change for a respondent if they instead have 7, or 9 poor physical health days? What if they have or don’t have a history of smoking?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>c8_new2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">subjectid =</span> <span class="dv">1001</span><span class="sc">:</span><span class="dv">1006</span>, <span class="at">smoke100 =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">physhealth =</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>))</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>pred2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod4, <span class="at">newdata =</span> c8_new2, <span class="at">interval =</span> <span class="st">"prediction"</span>, <span class="at">level =</span> <span class="fl">0.95</span>) <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>()</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>result2 <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(c8_new2, pred2)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>result2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  subjectid smoke100 physhealth   fit   lwr   upr
      &lt;int&gt;    &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1      1001        1          7  29.1  16.8  41.3
2      1002        1          8  29.2  16.9  41.5
3      1003        1          9  29.3  17.1  41.6
4      1004        0          7  28.2  16.0  40.5
5      1005        0          8  28.4  16.1  40.6
6      1006        0          9  28.5  16.2  40.7</code></pre>
</div>
</div>
<p>The <code>result2</code> tibble contains predictions for each scenario.</p>
<ul>
<li>Which has a bigger impact on these predictions and prediction intervals? A one category change in <code>smoke100</code> or a one hour change in <code>physhealth</code>?</li>
</ul>
</section>
</section>
<section id="centering-the-model" class="level2" data-number="12.8">
<h2 data-number="12.8" class="anchored" data-anchor-id="centering-the-model"><span class="header-section-number">12.8</span> Centering the model</h2>
<p>Our model <code>mod4</code> has four predictors (the constant, <code>physhealth</code>, <code>smoke100</code> and their interaction) but just two inputs (<code>smoke100</code> and <code>physhealth</code>.) If we <strong>center</strong> the quantitative input <code>physhealth</code> before building the model, we get a more interpretable interaction term.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>smart_cle1_sh_c <span class="ot">&lt;-</span> smart_cle1_sh <span class="sc">|&gt;</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">physhealth_c =</span> physhealth <span class="sc">-</span> <span class="fu">mean</span>(physhealth))</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>mod4_c <span class="ot">&lt;-</span> <span class="fu">lm</span>(bmi <span class="sc">~</span> smoke100 <span class="sc">*</span> physhealth_c, <span class="at">data =</span> smart_cle1_sh_c)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod4_c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = bmi ~ smoke100 * physhealth_c, data = smart_cle1_sh_c)

Residuals:
    Min      1Q  Median      3Q     Max 
-19.011  -3.811  -0.559   2.609  38.249 

Coefficients:
                      Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)           27.99821    0.25576 109.471  &lt; 2e-16 ***
smoke100               0.72589    0.37288   1.947 0.051818 .  
physhealth_c           0.10840    0.02995   3.619 0.000308 ***
smoke100:physhealth_c  0.03326    0.04093   0.813 0.416561    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 6.252 on 1129 degrees of freedom
Multiple R-squared:  0.03782,   Adjusted R-squared:  0.03526 
F-statistic: 14.79 on 3 and 1129 DF,  p-value: 1.886e-09</code></pre>
</div>
</div>
<p>What has changed as compared to the original <code>mod4</code>?</p>
<ul>
<li>Our original model was <code>bmi</code> = 27.5 + 0.57 <code>smoke100</code> + 0.11 <code>physhealth</code> - 0.03 <code>smoke100</code> x <code>physhealth</code></li>
<li>Our new model is <code>bmi</code> = 28.0 + 0.73 <code>smoke100</code> + 0.11 centered <code>physhealth</code> + 0.03 <code>smoke100</code> x centered <code>physhealth</code>.</li>
</ul>
<p>So our new model on centered data is:</p>
<ul>
<li>28.0 + 0.11 centered <code>physhealth_c</code> for non-smokers, and</li>
<li>(28.0 + 0.73) + (0.11 - 0.03) centered <code>physhealth_c</code>, or 28.73 + 0.08 centered <code>physhealth_c</code> for smokers.</li>
</ul>
<p>In our new (centered <code>physhealth_c</code>) model,</p>
<ul>
<li>the main effect of <code>smoke100</code> now corresponds to a predictive difference (smoker - non-smoker) in <code>bmi</code> with <code>physhealth</code> at its mean value, 4.68 days,</li>
<li>the intercept term is now the predicted <code>bmi</code> for a non-smoker with an average <code>physhealth</code>, and</li>
<li>the product term corresponds to the change in the slope of centered <code>physhealth_c</code> on <code>bmi</code> for a smoker rather than a non-smoker, while</li>
<li>the residual standard deviation and the R-squared values remain unchanged from the model before centering.</li>
</ul>
<section id="plot-of-model-4-on-centered-physhealth-mod4_c" class="level3" data-number="12.8.1">
<h3 data-number="12.8.1" class="anchored" data-anchor-id="plot-of-model-4-on-centered-physhealth-mod4_c"><span class="header-section-number">12.8.1</span> Plot of Model 4 on Centered <code>physhealth</code>: <code>mod4_c</code></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(smart_cle1_sh_c, <span class="fu">aes</span>(<span class="at">x =</span> physhealth_c, <span class="at">y =</span> bmi, <span class="at">group =</span> smoke100, <span class="at">col =</span> <span class="fu">factor</span>(smoke100))) <span class="sc">+</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">formula =</span> y <span class="sc">~</span> x) <span class="sc">+</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Poor Physical Health Days, centered"</span>, <span class="at">y =</span> <span class="st">"Body Mass Index"</span>,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">"Model `mod4` on centered data"</span>) <span class="sc">+</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> smoke100, <span class="at">labeller =</span> label_both)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ancova_smart_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="rescaling-an-input-by-subtracting-the-mean-and-dividing-by-2-standard-deviations" class="level2" data-number="12.9">
<h2 data-number="12.9" class="anchored" data-anchor-id="rescaling-an-input-by-subtracting-the-mean-and-dividing-by-2-standard-deviations"><span class="header-section-number">12.9</span> Rescaling an input by subtracting the mean and dividing by 2 standard deviations</h2>
<p>Centering helped us interpret the main effects in the regression, but it still leaves a scaling problem.</p>
<ul>
<li>The <code>smoke100</code> coefficient estimate is much larger than that of <code>physhealth</code>, but this is misleading, considering that we are comparing the complete change in one variable (smoking or not) to a 1-day change in <code>physhealth</code>.</li>
<li><span class="citation" data-cites="GelmanHill2007">Gelman and Hill (<a href="references.html#ref-GelmanHill2007" role="doc-biblioref">2007</a>)</span> recommend all continuous predictors be scaled by dividing by 2 standard deviations, so that:
<ul>
<li>a 1-unit change in the rescaled predictor corresponds to a change from 1 standard deviation below the mean, to 1 standard deviation above.</li>
<li>an unscaled binary (1/0) predictor with 50% probability of occurring will be exactly comparable to a rescaled continuous predictor done in this way.</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>smart_cle1_sh_rescale <span class="ot">&lt;-</span> smart_cle1_sh <span class="sc">|&gt;</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">physhealth_z =</span> (physhealth <span class="sc">-</span> <span class="fu">mean</span>(physhealth))<span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span><span class="fu">sd</span>(physhealth)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="refitting-model-mod4-to-the-rescaled-data" class="level3" data-number="12.9.1">
<h3 data-number="12.9.1" class="anchored" data-anchor-id="refitting-model-mod4-to-the-rescaled-data"><span class="header-section-number">12.9.1</span> Refitting model <code>mod4</code> to the rescaled data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>mod4_z <span class="ot">&lt;-</span> <span class="fu">lm</span>(bmi <span class="sc">~</span> smoke100 <span class="sc">*</span> physhealth_z, <span class="at">data =</span> smart_cle1_sh_rescale)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod4_z)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = bmi ~ smoke100 * physhealth_z, data = smart_cle1_sh_rescale)

Residuals:
    Min      1Q  Median      3Q     Max 
-19.011  -3.811  -0.559   2.609  38.249 

Coefficients:
                      Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)            27.9982     0.2558 109.471  &lt; 2e-16 ***
smoke100                0.7259     0.3729   1.947 0.051818 .  
physhealth_z            1.9774     0.5463   3.619 0.000308 ***
smoke100:physhealth_z   0.6068     0.7467   0.813 0.416561    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 6.252 on 1129 degrees of freedom
Multiple R-squared:  0.03782,   Adjusted R-squared:  0.03526 
F-statistic: 14.79 on 3 and 1129 DF,  p-value: 1.886e-09</code></pre>
</div>
</div>
</section>
<section id="interpreting-the-model-on-rescaled-data" class="level3" data-number="12.9.2">
<h3 data-number="12.9.2" class="anchored" data-anchor-id="interpreting-the-model-on-rescaled-data"><span class="header-section-number">12.9.2</span> Interpreting the model on rescaled data</h3>
<p>What has changed as compared to the original <code>mod4</code>?</p>
<ul>
<li>Our original model was <code>bmi</code> = 27.5 + 0.57 <code>smoke100</code> + 0.11 <code>physhealth</code> + 0.03 <code>smoke100</code> x <code>physhealth</code></li>
<li>Our model on centered <code>physhealth</code> was <code>bmi</code> = 28.0 + 0.73 <code>smoke100</code> + 0.11 centered <code>physhealth</code> + 0.03 <code>smoke100</code> x centered <code>physhealth</code>.</li>
<li>Our new model on rescaled <code>physhealth</code> is <code>bmi</code> = 28.0 + 0.73 <code>smoke100</code> + 1.98 rescaled <code>physhealth</code> + 0.61 <code>smoke100</code> x rescaled <code>physhealth</code></li>
</ul>
<p>So our rescaled model is:</p>
<ul>
<li>28.0 + 1.98 rescaled <code>physhealth_z</code> for non-smokers, and</li>
<li>(28.0 + 0.73) + (1.98 + 0.61) rescaled <code>physhealth_z</code>, or 28.73 + 2.59 rescaled <code>physhealth_z</code> for smokers.</li>
</ul>
<p>In this new rescaled (<code>physhealth_z</code>) model, then,</p>
<ul>
<li>the main effect of <code>smoke100</code>, 0.73, still corresponds to a predictive difference (smoker - non-smoker) in <code>bmi</code> with <code>physhealth</code> at its mean value, 4.68 days,</li>
<li>the intercept term is still the predicted <code>bmi</code> for a non-smoker with an average <code>physhealth</code> count, and</li>
<li>the residual standard deviation and the R-squared values remain unchanged,</li>
</ul>
<p>as before, but now we also have that:</p>
<ul>
<li>the coefficient of <code>physhealth_z</code> indicates the predictive difference in <code>bmi</code> associated with a change in <code>physhealth</code> of 2 standard deviations (from one standard deviation below the mean of 4.68 to one standard deviation above 4.68.)
<ul>
<li>Since the standard deviation of <code>physhealth</code> is 9.12 (see below), this covers a massive range of potential values of <code>physhealth</code> from 0 all the way up to 4.68 + 2(9.12) = 22.92 days.</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">favstats</span>(<span class="sc">~</span> physhealth, <span class="at">data =</span> smart_cle1_sh)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> min Q1 median Q3 max     mean       sd    n missing
   0  0      0  4  30 4.681377 9.120899 1133       0</code></pre>
</div>
</div>
<ul>
<li>the coefficient of the product term (0.61) corresponds to the change in the coefficient of <code>physhealth_z</code> for smokers as compared to non-smokers.</li>
</ul>
</section>
<section id="plot-of-model-on-rescaled-data" class="level3" data-number="12.9.3">
<h3 data-number="12.9.3" class="anchored" data-anchor-id="plot-of-model-on-rescaled-data"><span class="header-section-number">12.9.3</span> Plot of model on rescaled data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(smart_cle1_sh_rescale, <span class="fu">aes</span>(<span class="at">x =</span> physhealth_z, <span class="at">y =</span> bmi, </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">group =</span> smoke100, <span class="at">col =</span> <span class="fu">factor</span>(smoke100))) <span class="sc">+</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"Is subject a smoker?"</span>) <span class="sc">+</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Poor Physical Health Days, standardized (2 sd)"</span>, <span class="at">y =</span> <span class="st">"Body Mass Index"</span>,</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">"Model `mod4_z` on rescaled data"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ancova_smart_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>There’s very little difference here.</p>
</section>
</section>
<section id="mod5-what-if-we-add-more-variables" class="level2" data-number="12.10">
<h2 data-number="12.10" class="anchored" data-anchor-id="mod5-what-if-we-add-more-variables"><span class="header-section-number">12.10</span> <code>mod5</code>: What if we add more variables?</h2>
<p>We can boost our <span class="math inline">\(R^2\)</span> a bit, to nearly 5%, by adding in two new variables, related to whether or not the subject (in the past 30 days) used the internet, and the average number of alcoholic drinks per week consumed by ths subject.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>mod5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(bmi <span class="sc">~</span> smoke100 <span class="sc">+</span> female <span class="sc">+</span>physhealth <span class="sc">+</span> internet30 <span class="sc">+</span> drinks_wk,</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> smart_cle1_sh)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = bmi ~ smoke100 + female + physhealth + internet30 + 
    drinks_wk, data = smart_cle1_sh)

Residuals:
    Min      1Q  Median      3Q     Max 
-18.358  -3.846  -0.657   2.534  38.049 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 27.52400    0.56076  49.083  &lt; 2e-16 ***
smoke100     0.82654    0.37739   2.190  0.02872 *  
female      -0.43272    0.38510  -1.124  0.26140    
physhealth   0.12469    0.02074   6.012 2.47e-09 ***
internet30   0.44287    0.48830   0.907  0.36462    
drinks_wk   -0.10193    0.03352  -3.041  0.00241 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 6.231 on 1127 degrees of freedom
Multiple R-squared:  0.04582,   Adjusted R-squared:  0.04159 
F-statistic: 10.82 on 5 and 1127 DF,  p-value: 3.48e-10</code></pre>
</div>
</div>
<ol type="1">
<li>Here’s the ANOVA for this model. What can we study with this?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: bmi
             Df Sum Sq Mean Sq F value    Pr(&gt;F)    
smoke100      1    215  214.75  5.5304  0.018861 *  
female        1      5    4.85  0.1249  0.723878    
physhealth    1   1508 1508.08 38.8372 6.497e-10 ***
internet30    1     15   14.69  0.3783  0.538650    
drinks_wk     1    359  359.05  9.2466  0.002414 ** 
Residuals  1127  43762   38.83                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>Consider the revised output below. Now what can we study?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(<span class="fu">lm</span>(bmi <span class="sc">~</span> smoke100 <span class="sc">+</span> internet30 <span class="sc">+</span> drinks_wk <span class="sc">+</span> female <span class="sc">+</span> physhealth,</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> smart_cle1_sh))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: bmi
             Df Sum Sq Mean Sq F value    Pr(&gt;F)    
smoke100      1    215  214.75  5.5304 0.0188606 *  
internet30    1      8    7.81  0.2010 0.6539723    
drinks_wk     1    444  443.79 11.4288 0.0007479 ***
female        1     32   31.58  0.8132 0.3673566    
physhealth    1   1403 1403.49 36.1438 2.472e-09 ***
Residuals  1127  43762   38.83                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>What does the output below let us conclude?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(<span class="fu">lm</span>(bmi <span class="sc">~</span> smoke100 <span class="sc">+</span> internet30 <span class="sc">+</span> drinks_wk <span class="sc">+</span> female <span class="sc">+</span> physhealth, </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> smart_cle1_sh),</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lm</span>(bmi <span class="sc">~</span> smoke100 <span class="sc">+</span> female <span class="sc">+</span> drinks_wk, </span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> smart_cle1_sh))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: bmi ~ smoke100 + internet30 + drinks_wk + female + physhealth
Model 2: bmi ~ smoke100 + female + drinks_wk
  Res.Df   RSS Df Sum of Sq      F    Pr(&gt;F)    
1   1127 43762                                  
2   1129 45166 -2   -1403.7 18.075 1.877e-08 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<ol start="4" type="1">
<li>What does it mean for the models to be “nested”?</li>
</ol>
</section>
<section id="mod6-would-adding-self-reported-health-help" class="level2" data-number="12.11">
<h2 data-number="12.11" class="anchored" data-anchor-id="mod6-would-adding-self-reported-health-help"><span class="header-section-number">12.11</span> <code>mod6</code>: Would adding self-reported health help?</h2>
<p>And we can do even a bit better than that by adding in a multi-categorical measure: self-reported general health.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>mod6 <span class="ot">&lt;-</span> <span class="fu">lm</span>(bmi <span class="sc">~</span> female <span class="sc">+</span> smoke100 <span class="sc">+</span> physhealth <span class="sc">+</span> internet30 <span class="sc">+</span> drinks_wk <span class="sc">+</span> genhealth,</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> smart_cle1_sh)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = bmi ~ female + smoke100 + physhealth + internet30 + 
    drinks_wk + genhealth, data = smart_cle1_sh)

Residuals:
    Min      1Q  Median      3Q     Max 
-19.216  -3.659  -0.736   2.669  36.810 

Coefficients:
                    Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)         25.20736    0.71106  35.450  &lt; 2e-16 ***
female              -0.31949    0.37667  -0.848   0.3965    
smoke100             0.45866    0.37214   1.232   0.2180    
physhealth           0.04353    0.02506   1.737   0.0827 .  
internet30           0.93270    0.48273   1.932   0.0536 .  
drinks_wk           -0.07712    0.03294  -2.341   0.0194 *  
genhealth2_VeryGood  1.21169    0.56838   2.132   0.0332 *  
genhealth3_Good      3.22783    0.58009   5.564 3.29e-08 ***
genhealth4_Fair      4.14497    0.73284   5.656 1.96e-08 ***
genhealth5_Poor      5.86335    1.09253   5.367 9.73e-08 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 6.089 on 1123 degrees of freedom
Multiple R-squared:  0.09206,   Adjusted R-squared:  0.08478 
F-statistic: 12.65 on 9 and 1123 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<ol type="1">
<li><p>If Harry and Marty have the same values of <code>female</code>, <code>smoke100</code>, <code>physhealth</code>, <code>internet30</code> and <code>drinks_wk</code>, but Harry rates his health as Good, and Marty rates his as Fair, then what is the difference in the predictions? Who is predicted to have a larger BMI, and by how much?</p></li>
<li><p>What does this normal probability plot of the residuals suggest?</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod6, <span class="at">which =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ancova_smart_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="key-regression-assumptions-for-building-effective-prediction-models" class="level2" data-number="12.12">
<h2 data-number="12.12" class="anchored" data-anchor-id="key-regression-assumptions-for-building-effective-prediction-models"><span class="header-section-number">12.12</span> Key Regression Assumptions for Building Effective Prediction Models</h2>
<ol type="1">
<li>Validity - the data you are analyzing should map to the research question you are trying to answer.
<ul>
<li>The outcome should accurately reflect the phenomenon of interest.</li>
<li>The model should include all relevant predictors. (It can be difficult to decide which predictors are necessary, and what to do with predictors that have large standard errors.)</li>
<li>The model should generalize to all of the cases to which it will be applied.</li>
<li>Can the available data answer our question reliably?</li>
</ul></li>
<li>Additivity and linearity - most important assumption of a regression model is that its deterministic component is a linear function of the predictors. We often think about transformations in this setting.</li>
<li>Independence of errors - errors from the prediction line are independent of each other</li>
<li>Equal variance of errors - if this is violated, we can more efficiently estimate parameters using <em>weighted least squares</em> approaches, where each point is weighted inversely proportional to its variance, but this doesn’t affect the coefficients much, if at all.</li>
<li>Normality of errors - not generally important for estimating the regression line</li>
</ol>
<section id="checking-assumptions-in-model-mod6" class="level3" data-number="12.12.1">
<h3 data-number="12.12.1" class="anchored" data-anchor-id="checking-assumptions-in-model-mod6"><span class="header-section-number">12.12.1</span> Checking Assumptions in model <code>mod6</code></h3>
<ol type="1">
<li>How does the assumption of linearity behind this model look?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod6, <span class="at">which =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ancova_smart_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We see no strong signs of serious non-linearity here. There’s no obvious curve in the plot, for example. We may have a problem with increasing variance as we move to the right.</p>
<ol start="2" type="1">
<li>What can we conclude from the plot below?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod6, <span class="at">which =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ancova_smart_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This plot can help us identify points with large standardized residuals, large leverage values, and large influence on the model (as indicated by large values of Cook’s distance.) In this case, I see no signs of any points used in the model with especially large influence, although there are some poorly fitted points (with especially large standardized residuals.)</p>
<p>We might want to identify the point listed here as 961, which appears to have an enormous standardized residual. To do so, we can use the <code>slice</code> function from <code>dplyr</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>smart_cle1_sh <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">961</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(SEQNO)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
       SEQNO
       &lt;dbl&gt;
1 2017000961</code></pre>
</div>
</div>
<p>Now we know exactly which subject we’re talking about.</p>
<ol start="3" type="1">
<li>What other residual plots are available with <code>plot</code> and how do we interpret them?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod6, <span class="at">which =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ancova_smart_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This plot is simply a Normal Q-Q plot of the standardized residuals from our model. We’re looking here for serious problems with the assumption of Normality.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod6, <span class="at">which =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ancova_smart_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This is a scale-location plot, designed to help us see non-constant variance in the residuals as we move across the fitted values as a linear trend, rather than as a fan shape, by plotting the square root of the residuals on the vertical axis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod6, <span class="at">which =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ancova_smart_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Finally, this is an index plot of the Cook’s distance values, allowing us to identify points that are particularly large. Remember that a value of 0.5 (or perhaps even 1.0) is a reasonable boundary for a substantially influential point.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-GelmanHill2007" class="csl-entry" role="listitem">
Gelman, Andrew, and Jennifer Hill. 2007. <em>Data Analysis Using Regression and Multilevel/Hierarchical Models</em>. New York: Cambridge University Press.
</div>
</div>
</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>I’ll now refer to those who have smoked at least 100 cigarettes in their life as smokers, and those who have not as non-smokers to save some space.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./ancova_emphysema.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Analysis of Covariance</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./nonlinearity.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Adding Non-linear Terms to a Linear Regression</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>